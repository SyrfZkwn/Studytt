{% extends "base.html" %} 
<title>{% block title %}Post{% endblock %}</title>

{% block content %}

<form method="POST" enctype="multipart/form-data" class="mt-3">

    <div class="mb-3">
        {{ form.subject(class="form-control py-4", style="border-radius: 20px;", placeholder="Enter Subject Code e.g. CPP1113") }}
    </div>

    <div class="mb-3">
        {{ form.chapter(class="form-control py-4", style="border-radius: 20px;", placeholder="Enter Chapter e.g. Chapter 2 Kinematics") }}
    </div>

    <div class="text-container">
        <div class="mb-3">
            {{ form.file(id="fileInput", hidden=true) }}

            <button type="button" class="btn btn-success" onclick="document.getElementById('fileInput').click();">
                <span class="material-symbols-outlined">
                    attach_file
                </span>
            </button>

            <span id="fileName" class="ms-2 text-muted"></span>

            <div id="filePreview" class="mt-3"></div>
        </div>
    </div>
    
    <div class="text-end">
        {{ form.submit (style="color: #f15c22; background-color: #1b4f83; border-radius: 20px; font-size: 30px; width: 8rem;")}}
    </div>

</form>

<script>
    document.getElementById("fileInput").addEventListener("change", function () {
        const file = this.files[0];
        const fileNameSpan = document.getElementById("fileName");
        const filePreviewDiv = document.getElementById("filePreview");

        // Show file name
        if (file) {
            fileNameSpan.textContent = file.name;

            // Reset preview first
            filePreviewDiv.innerHTML = "";

            if (file.type.startsWith("image/")) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    filePreviewDiv.innerHTML = `<img src="${e.target.result}" alt="Preview" class="img-fluid rounded mt-2" style="max-height: 300px;">`;
                };
                reader.readAsDataURL(file);
            } else if (file.type === "application/pdf") {
                const reader = new FileReader();
                reader.onload = function (e) {
                    filePreviewDiv.innerHTML = `<embed src="${e.target.result}" type="application/pdf" width="100%" height="500px" class="mt-2 rounded border" />`;
                };
                reader.readAsDataURL(file);
            } else {
                filePreviewDiv.innerHTML = '<p class="text-muted">No preview available for this file type.</p>';
            }
        } else {
            fileNameSpan.textContent = "";
            filePreviewDiv.innerHTML = "";
        }
    });
</script>

{% endblock %}